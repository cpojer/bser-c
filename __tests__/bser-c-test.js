'use strict';

const path = require('path');
const bser = require('bindings')('bser');

const template = Buffer.from([
  0x00, 0x01, 0x03, 0x28,
  0x0b, 0x00, 0x03, 0x02, 0x02, 0x03, 0x04, 0x6e, 0x61, 0x6d, 0x65, 0x02,
  0x03, 0x03, 0x61, 0x67, 0x65, 0x03, 0x03, 0x02, 0x03, 0x04, 0x66, 0x72,
  0x65, 0x64, 0x03, 0x14, 0x02, 0x03, 0x04, 0x70, 0x65, 0x74, 0x65, 0x03,
  0x1e, 0x0c, 0x03, 0x19,
]);

describe('bser-c', () => {
  it('loads', () => {
    expect(
      () => bser.loads('asdf')
    ).toThrow(new Error(
      'bser.loads: argument is not a buffer.'
    ));

    const parsed = bser.loads(template);
    expect(parsed).toEqual([
      {name: 'fred', age: 20},
      {name: 'pete', age: 30},
      {age: 25}
    ]);
  });
});
